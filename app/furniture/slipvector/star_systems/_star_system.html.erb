<%= render CardComponent.new do |card| %>
  <%- card.with_header do %>
    <h2><%= star_system.name %></h2>

    <div class="mt-2 grid grid-cols-2 sm:grid-cols-4 gap-3">
      <%- star_system.experience.pools.each do |pool| %>
        <div class="flex flex-wrap justify-between">
          <span><%= pool.label %></span>
          <span>
            <%= pool.xp %> of <%= pool.next_level_xp %>
          </span>
          <%- if pool.ready_for_level_up? %>
            <%= link_to("⬆️ Level Up!", "#", class: "w-full text-center p-2 rounded bg-yellow-100 no-underline border-yellow-500") %>
          <%- end %>
        </div>
      <%- end %>
    </div>

  <%- end %>

  <%- @pagy, @surveys = pagy(policy_scope(star_system.surveys.complete.recent), items: 8) %>

  <div class="grid gap-3 grid-cols-2 sm:grid-cols-4">
    <%- @surveys.each do |survey| %>
      <%= link_to(survey.name, survey.location) %>
    <%- end %>
  </div>

  <%== pagy_nav(@pagy, nav_extra: 'flex justify-between') %>

  <%- card.with_footer(variant: :action_bar) do %>
    <%- if star_system.active_surveys.present? %>
      <%- active_survey = star_system.active_surveys.first %>
      <%= link_to "Resume Survey #{active_survey.id}", star_system.active_surveys.first.location, class: "w-full button" %>
    <%- else %>
      <%= button_to("Begin Survey", star_system.location(child: :surveys), params: { survey: { status: :active } }, form_class: "w-full", class: "w-full") %>
    <%- end %>
  <%- end %>
<%- end %>
